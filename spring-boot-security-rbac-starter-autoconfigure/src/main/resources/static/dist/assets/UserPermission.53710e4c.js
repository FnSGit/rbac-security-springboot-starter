import{e,d as a,y as l,p as o,b as d,L as t,r,o as n,c as s,i,F as u,l as m,j as c,t as p,w as f}from"./vendor.47dfe678.js";import{a as h}from"./index.9f023405.js";const b={name:"user-permission",setup(){let o=e({roles:[],pageData:[]});h.getRoles().then((e=>{200==e.code&&(o.roles=e.data,o.roles.unshift({name:"全部"}))}));const d=e({role:"",name:"",pageNo:1,pageSize:10,totalPages:0,recordCount:0}),r=a([]),n=a(0),s=()=>{null==d.role||0==d.role.length||"全部"==d.role||null==d.name||0==d.name?("全部"===d.role&&(d.role=""),h.getPermission(d).then((e=>{200===e.code?(o.pageData=e.data.pageData,d.totalPages=e.data.totalPages,d.recordCount=e.data.recordCount):l.error(e.message)}))):l.error("只允许根据角色或者权限名中的一个进行搜索")};s();const i=a(!1);let u=e({id:"",name:"",resource:"",describe:""});let m=a(!1);return{dat:o,query:d,tableData:r,pageTotal:n,editVisible:i,addVisible:m,form:u,handleSearch:()=>{d.pageNo=1,s()},handlePageChange:e=>{d.pageIndex=e,s()},handleDelete:(e,a)=>{t.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{h.deletePermission(a.id).then((e=>{200===e.code?(l.success("删除成功"),s()):l.error(e.message)}))})).catch((()=>{}))},handleEdit:(e,a)=>{u.id=a.id,Object.keys(u).forEach((e=>{u[e]=a[e]})),i.value=!0},saveEdit:()=>{console.log(u),h.updatePermission(u).then((e=>{200===e.code?(i.value=!1,l.success("修改成功"),s()):l.error(e.message)}))},handleAdd:()=>{Object.keys(u).forEach((e=>{u[e]=""})),m.value=!0},addPermission:()=>{h.addPermission(u).then((e=>{200===e.code?(l.success("添加成功"),m.value=!1,s()):l.error(e.message)}))}}},data:()=>({grantVisible:!1,target:[],data:[],pid:0}),methods:{handleGrant(e,a){this.grantVisible=!this.grantVisible,this.pid=a.id,h.listPermissionAssociatedRole(a.id).then((e=>{200===e.code?this.target=e.data:l.error(e.message)}))},filterMethod:(e,a)=>a.spell.indexOf(e)>-1,handleChange(e,a,o){console.log(e,a,o),console.log(this.pid),"left"===a?h.cancelRolePermission(this.pid,o).then((e=>{200===e.code?l.success("更新成功"):l.error(e.message)})):h.grantRolePermission(this.pid,o).then((e=>{200===e.code?l.success("更新成功"):l.error(e.message)}))}},created(){h.getRoles().then((e=>{200==e.code&&e.data.forEach((e=>{this.data.push({label:e.name,key:e.id,spell:e.name})}))}))}},g=f();o("data-v-a9671e5a");const V={class:"crumbs"},C=i("i",{class:"el-icon-lx-cascades"},null,-1),_=c(" 权限管理 "),y={class:"container"},k={class:"handle-box"},w=c("搜索"),U=c("编辑 "),v=c("删除"),x=c("授权"),N={class:"pagination"},O={class:"dialog-footer"},P=c("取 消"),S=c("确 定"),A={class:"dialog-footer"},q=c("取 消"),D=c("确 定");d();const M=g(((e,a,l,o,d,t)=>{const f=r("el-breadcrumb-item"),h=r("el-breadcrumb"),b=r("el-option"),M=r("el-select"),E=r("el-input"),Y=r("el-button"),j=r("el-table-column"),R=r("el-table"),z=r("el-pagination"),I=r("el-form-item"),$=r("el-form"),G=r("el-dialog"),T=r("el-transfer");return n(),s("div",null,[i("div",V,[i(h,{separator:"/"},{default:g((()=>[i(f,null,{default:g((()=>[C,_])),_:1})])),_:1})]),i("div",y,[i("div",k,[i(M,{modelValue:o.query.role,"onUpdate:modelValue":a[1]||(a[1]=e=>o.query.role=e),placeholder:"角色",class:"handle-select mr10"},{default:g((()=>[(n(!0),s(u,null,m(o.dat.roles,(e=>(n(),s(b,{key:e.id,label:e.name,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),i(E,{modelValue:o.query.name,"onUpdate:modelValue":a[2]||(a[2]=e=>o.query.name=e),placeholder:"权限名",class:"handle-input mr10"},null,8,["modelValue"]),i(Y,{type:"primary",icon:"el-icon-search",onClick:o.handleSearch},{default:g((()=>[w])),_:1},8,["onClick"]),i(Y,{icon:"el-icon-lx-add",onClick:o.handleAdd,circle:""},null,8,["onClick"])]),i(R,{data:o.dat.pageData,border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:g((()=>[i(j,{prop:"id",label:"ID",width:"55",align:"center"}),i(j,{prop:"name",label:"权限名"}),i(j,{label:"持有资源"},{default:g((e=>[c(p(e.row.resource),1)])),_:1}),i(j,{label:"权限描述"},{default:g((e=>[c(p(e.row.describe),1)])),_:1}),i(j,{label:"操作",align:"center"},{default:g((e=>[i(Y,{disabled:"ANONYMOUS"===e.row.name||"root"===e.row.name,type:"text",icon:"el-icon-edit",onClick:a=>o.handleEdit(e.$index,e.row)},{default:g((()=>[U])),_:2},1032,["disabled","onClick"]),i(Y,{disabled:"ANONYMOUS"===e.row.name||"root"===e.row.name,type:"text",icon:"el-icon-delete",class:"ANONYMOUS"===e.row.name||"root"===e.row.name?"":"red",onClick:a=>o.handleDelete(e.$index,e.row)},{default:g((()=>[v])),_:2},1032,["disabled","class","onClick"]),i(Y,{type:"text",icon:"el-icon-edit",onClick:a=>t.handleGrant(e.$index,e.row)},{default:g((()=>[x])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),i("div",N,[i(z,{background:"",layout:"total, prev, pager, next","current-page":o.query.pageNo,"page-size":o.query.pageSize,total:o.query.recordCount,onCurrentChange:o.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])]),i(G,{title:"编辑",modelValue:o.editVisible,"onUpdate:modelValue":a[7]||(a[7]=e=>o.editVisible=e),width:"30%"},{footer:g((()=>[i("span",O,[i(Y,{onClick:a[6]||(a[6]=e=>o.editVisible=!1)},{default:g((()=>[P])),_:1}),i(Y,{type:"primary",onClick:o.saveEdit},{default:g((()=>[S])),_:1},8,["onClick"])])])),default:g((()=>[i($,{"label-width":"70px"},{default:g((()=>[i(I,{label:"权限名"},{default:g((()=>[i(E,{disabled:"ANONYMOUS"===o.form.name||"root"===o.form.name,modelValue:o.form.name,"onUpdate:modelValue":a[3]||(a[3]=e=>o.form.name=e)},null,8,["disabled","modelValue"])])),_:1}),i(I,{label:"持有资源"},{default:g((()=>[i(E,{disabled:"ANONYMOUS"===o.form.name||"root"===o.form.name,modelValue:o.form.resource,"onUpdate:modelValue":a[4]||(a[4]=e=>o.form.resource=e)},null,8,["disabled","modelValue"])])),_:1}),i(I,{label:"权限介绍"},{default:g((()=>[i(E,{disabled:"ANONYMOUS"===o.form.name||"root"===o.form.name,modelValue:o.form.describe,"onUpdate:modelValue":a[5]||(a[5]=e=>o.form.describe=e)},null,8,["disabled","modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),i(G,{title:"添加角色",modelValue:o.addVisible,"onUpdate:modelValue":a[12]||(a[12]=e=>o.addVisible=e),width:"30%"},{footer:g((()=>[i("span",A,[i(Y,{onClick:a[11]||(a[11]=e=>o.editVisible=!1)},{default:g((()=>[q])),_:1}),i(Y,{type:"primary",onClick:o.addPermission},{default:g((()=>[D])),_:1},8,["onClick"])])])),default:g((()=>[i($,{"label-width":"70px"},{default:g((()=>[i(I,{label:"权限名"},{default:g((()=>[i(E,{modelValue:o.form.name,"onUpdate:modelValue":a[8]||(a[8]=e=>o.form.name=e)},null,8,["modelValue"])])),_:1}),i(I,{label:"权限描述"},{default:g((()=>[i(E,{modelValue:o.form.resource,"onUpdate:modelValue":a[9]||(a[9]=e=>o.form.resource=e)},null,8,["modelValue"])])),_:1}),i(I,{label:"权限描述"},{default:g((()=>[i(E,{modelValue:o.form.describe,"onUpdate:modelValue":a[10]||(a[10]=e=>o.form.describe=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),i(G,{modelValue:d.grantVisible,"onUpdate:modelValue":a[14]||(a[14]=e=>d.grantVisible=e),width:"650px"},{default:g((()=>[i(T,{modelValue:d.target,"onUpdate:modelValue":a[13]||(a[13]=e=>d.target=e),filterable:"","filter-method":t.filterMethod,"filter-placeholder":"请输入角色名",titles:["无该权限的角色","有该权限的角色"],data:d.data,onChange:t.handleChange},null,8,["modelValue","filter-method","data","onChange"])])),_:1},8,["modelValue"])])}));b.render=M,b.__scopeId="data-v-a9671e5a";export default b;
