import{e,d as l,y as a,p as o,b as d,L as t,r,o as n,c as s,i,F as u,l as c,j as m,t as p,w as f}from"./vendor.47dfe678.js";import{a as h}from"./index.f0cfd1f9.js";const b={name:"user-permission",setup(){let o=e({roles:[],pageData:[]});h.getRoles().then((e=>{200==e.code&&(o.roles=e.data,o.roles.unshift({name:"全部"}))}));const d=e({role:"",name:"",pageNo:1,pageSize:10,totalPages:0,recordCount:0}),r=l([]),n=l(0),s=()=>{null==d.role||0==d.role.length||"全部"==d.role||null==d.name||0==d.name?("全部"===d.role&&(d.role=""),h.getPermission(d).then((e=>{200===e.code?(o.pageData=e.data.pageData,d.totalPages=e.data.totalPages,d.recordCount=e.data.recordCount):a.error(e.message)}))):a.error("只允许根据角色或者权限名中的一个进行搜索")};s();const i=l(!1);let u=e({id:"",name:"",resource:"",describe:""});let c=l(!1);return{dat:o,query:d,tableData:r,pageTotal:n,editVisible:i,addVisible:c,form:u,handleSearch:()=>{d.pageNo=1,s()},handlePageChange:e=>{d.pageIndex=e,s()},handleDelete:(e,l)=>{t.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{h.deletePermission(l.id).then((e=>{200===e.code?(a.success("删除成功"),s()):a.error(e.message)}))})).catch((()=>{}))},handleEdit:(e,l)=>{u.id=l.id,Object.keys(u).forEach((e=>{u[e]=l[e]})),i.value=!0},saveEdit:()=>{console.log(u),h.updatePermission(u).then((e=>{200===e.code?(i.value=!1,a.success("修改成功"),s()):a.error(e.message)}))},handleAdd:()=>{Object.keys(u).forEach((e=>{u[e]=""})),c.value=!0},addPermission:()=>{h.addPermission(u).then((e=>{200===e.code?(a.success("添加成功"),c.value=!1,s()):a.error(e.message)}))}}},data:()=>({grantVisible:!1,target:[],data:[],pid:0}),methods:{handleGrant(e,l){this.grantVisible=!this.grantVisible,this.pid=l.id,h.listPermissionAssociatedRole(l.id).then((e=>{200===e.code?this.target=e.data:a.error(e.message)}))},filterMethod:(e,l)=>l.spell.indexOf(e)>-1,handleChange(e,l,o){console.log(e,l,o),console.log(this.pid),"left"===l?h.cancelRolePermission(this.pid,o).then((e=>{200===e.code?a.success("更新成功"):a.error(e.message)})):h.grantRolePermission(this.pid,o).then((e=>{200===e.code?a.success("更新成功"):a.error(e.message)}))}},created(){h.getRoles().then((e=>{200==e.code&&e.data.forEach((e=>{this.data.push({label:e.name,key:e.id,spell:e.name})}))}))}},g=f();o("data-v-6337c8b4");const V={class:"crumbs"},C=i("i",{class:"el-icon-lx-cascades"},null,-1),_=m(" 权限管理 "),y={class:"container"},k={class:"handle-box"},w=m("搜索"),U=m("编辑 "),v=m("删除"),x=m("授权"),N={class:"pagination"},O={class:"dialog-footer"},P=m("取 消"),S=m("确 定"),A={class:"dialog-footer"},q=m("取 消"),D=m("确 定");d();const M=g(((e,l,a,o,d,t)=>{const f=r("el-breadcrumb-item"),h=r("el-breadcrumb"),b=r("el-option"),M=r("el-select"),E=r("el-input"),Y=r("el-button"),j=r("el-table-column"),R=r("el-table"),z=r("el-pagination"),I=r("el-form-item"),$=r("el-form"),G=r("el-dialog"),T=r("el-transfer");return n(),s("div",null,[i("div",V,[i(h,{separator:"/"},{default:g((()=>[i(f,null,{default:g((()=>[C,_])),_:1})])),_:1})]),i("div",y,[i("div",k,[i(M,{modelValue:o.query.role,"onUpdate:modelValue":l[1]||(l[1]=e=>o.query.role=e),placeholder:"角色",class:"handle-select mr10"},{default:g((()=>[(n(!0),s(u,null,c(o.dat.roles,(e=>(n(),s(b,{key:e.id,label:e.name,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),i(E,{modelValue:o.query.name,"onUpdate:modelValue":l[2]||(l[2]=e=>o.query.name=e),placeholder:"权限名",class:"handle-input mr10"},null,8,["modelValue"]),i(Y,{type:"primary",icon:"el-icon-search",onClick:o.handleSearch},{default:g((()=>[w])),_:1},8,["onClick"]),i(Y,{icon:"el-icon-lx-add",onClick:o.handleAdd,circle:""},null,8,["onClick"])]),i(R,{data:o.dat.pageData,border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:g((()=>[i(j,{prop:"id",label:"ID",width:"55",align:"center"}),i(j,{prop:"name",label:"权限名"}),i(j,{label:"持有资源"},{default:g((e=>[m(p(e.row.resource),1)])),_:1}),i(j,{label:"权限描述"},{default:g((e=>[m(p(e.row.describe),1)])),_:1}),i(j,{label:"操作",align:"center"},{default:g((e=>[i(Y,{disabled:"ANONYMOUS"===e.row.name||"root"===e.row.name,type:"text",icon:"el-icon-edit",onClick:l=>o.handleEdit(e.$index,e.row)},{default:g((()=>[U])),_:2},1032,["disabled","onClick"]),i(Y,{disabled:"ANONYMOUS"===e.row.name||"root"===e.row.name,type:"text",icon:"el-icon-delete",class:"ANONYMOUS"===e.row.name||"root"===e.row.name?"":"red",onClick:l=>o.handleDelete(e.$index,e.row)},{default:g((()=>[v])),_:2},1032,["disabled","class","onClick"]),i(Y,{type:"text",icon:"el-icon-edit",onClick:l=>t.handleGrant(e.$index,e.row)},{default:g((()=>[x])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),i("div",N,[i(z,{background:"",layout:"total, prev, pager, next","current-page":o.query.pageNo,"page-size":o.query.pageSize,total:o.query.recordCount,onCurrentChange:o.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])]),i(G,{title:"编辑",modelValue:o.editVisible,"onUpdate:modelValue":l[7]||(l[7]=e=>o.editVisible=e),width:"30%"},{footer:g((()=>[i("span",O,[i(Y,{onClick:l[6]||(l[6]=e=>o.editVisible=!1)},{default:g((()=>[P])),_:1}),i(Y,{type:"primary",onClick:o.saveEdit},{default:g((()=>[S])),_:1},8,["onClick"])])])),default:g((()=>[i($,{"label-width":"70px"},{default:g((()=>[i(I,{label:"权限名"},{default:g((()=>[i(E,{disabled:"ANONYMOUS"===o.form.name||"root"===o.form.name,modelValue:o.form.name,"onUpdate:modelValue":l[3]||(l[3]=e=>o.form.name=e)},null,8,["disabled","modelValue"])])),_:1}),i(I,{label:"持有资源"},{default:g((()=>[i(E,{disabled:"ANONYMOUS"===o.form.name||"root"===o.form.name,modelValue:o.form.resource,"onUpdate:modelValue":l[4]||(l[4]=e=>o.form.resource=e)},null,8,["disabled","modelValue"])])),_:1}),i(I,{label:"权限介绍"},{default:g((()=>[i(E,{disabled:"ANONYMOUS"===o.form.name||"root"===o.form.name,modelValue:o.form.describe,"onUpdate:modelValue":l[5]||(l[5]=e=>o.form.describe=e)},null,8,["disabled","modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),i(G,{title:"添加权限",modelValue:o.addVisible,"onUpdate:modelValue":l[12]||(l[12]=e=>o.addVisible=e),width:"30%"},{footer:g((()=>[i("span",A,[i(Y,{onClick:l[11]||(l[11]=e=>o.editVisible=!1)},{default:g((()=>[q])),_:1}),i(Y,{type:"primary",onClick:o.addPermission},{default:g((()=>[D])),_:1},8,["onClick"])])])),default:g((()=>[i($,{"label-width":"70px"},{default:g((()=>[i(I,{label:"权限名"},{default:g((()=>[i(E,{modelValue:o.form.name,"onUpdate:modelValue":l[8]||(l[8]=e=>o.form.name=e)},null,8,["modelValue"])])),_:1}),i(I,{label:"权限描述"},{default:g((()=>[i(E,{modelValue:o.form.resource,"onUpdate:modelValue":l[9]||(l[9]=e=>o.form.resource=e)},null,8,["modelValue"])])),_:1}),i(I,{label:"权限描述"},{default:g((()=>[i(E,{modelValue:o.form.describe,"onUpdate:modelValue":l[10]||(l[10]=e=>o.form.describe=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),i(G,{modelValue:d.grantVisible,"onUpdate:modelValue":l[14]||(l[14]=e=>d.grantVisible=e),width:"650px"},{default:g((()=>[i(T,{modelValue:d.target,"onUpdate:modelValue":l[13]||(l[13]=e=>d.target=e),filterable:"","filter-method":t.filterMethod,"filter-placeholder":"请输入角色名",titles:["无该权限的角色","有该权限的角色"],data:d.data,onChange:t.handleChange},null,8,["modelValue","filter-method","data","onChange"])])),_:1},8,["modelValue"])])}));b.render=M,b.__scopeId="data-v-6337c8b4";export default b;
